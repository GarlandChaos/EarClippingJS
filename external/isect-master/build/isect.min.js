!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r(t.isect={})}(this,function(t){"use strict";var f=function(t,r){this.key=t,this.data=r,this.left=null,this.right=null};function r(t,r){return r<t?1:t<r?-1:0}function u(t,r,e){if(null===r)return r;var n,i,o,a=new f;for(n=i=a;;){var s=e(t,r.key);if(s<0){if(null===r.left)break;if(e(t,r.left.key)<0&&(o=r.left,r.left=o.right,o.right=r,null===(r=o).left))break;i.left=r,r=(i=r).left}else{if(!(0<s))break;if(null===r.right)break;if(0<e(t,r.right.key)&&(o=r.right,r.right=o.left,o.left=r,null===(r=o).right))break;n.right=r,r=(n=r).right}}return n.right=r.left,i.left=r.right,r.left=a.right,r.right=a.left,r}function l(t,r,e,n,i){var o=new f(t,r);if(i._size++,null===e)return o.left=o.right=null,o;var a=n(t,(e=u(t,e,n)).key);return a<0?(o.left=e.left,(o.right=e).left=null):0<=a&&(o.right=e.right,(o.left=e).right=null),o}function e(t,r,e,n){var i;return null===r?null:0===e(t,(r=u(t,r,e)).key)?(null===r.left?i=r.right:(i=u(t,r.left,e)).right=r.right,n._size--,i):r}function y(t,r,e){var n,i;if(null===r)n=i=null;else{var o=e((r=u(t,r,e)).key,t);0===o?(n=r.left,i=r.right):o<0?(i=r.right,r.right=null,n=r):(n=r.left,r.left=null,i=r)}return{left:n,right:i}}var m=function(t){void 0===t&&(t=r),this._comparator=t,this._root=null,this._size=0},n={size:{configurable:!0}};m.prototype.insert=function(t,r){return this._root=l(t,r,this._root,this._comparator,this)},m.prototype.add=function(t,r){return this._root=function(t,r,e,n,i){var o=new f(t,r);if(null===e)return o.left=o.right=null,i._size++,o;var a=n(t,(e=u(t,e,n)).key);return 0===a?e:(a<0?(o.left=e.left,(o.right=e).left=null):0<a&&(o.right=e.right,(o.left=e).right=null),i._size++,o)}(t,r,this._root,this._comparator,this)},m.prototype.remove=function(t){this._root=e(t,this._root,this._comparator,this)},m.prototype.pop=function(){var t=this._root;if(t){for(;t.left;)t=t.left;return this._root=u(t.key,this._root,this._comparator),this._root=e(t.key,this._root,this._comparator,this),{key:t.key,data:t.data}}return null},m.prototype.findStatic=function(t){for(var r=this._root,e=this._comparator;r;){var n=e(t,r.key);if(0===n)return r;r=n<0?r.left:r.right}return null},m.prototype.find=function(t){return this._root&&(this._root=u(t,this._root,this._comparator),0!==this._comparator(t,this._root.key))?null:this._root},m.prototype.contains=function(t){for(var r=this._root,e=this._comparator;r;){var n=e(t,r.key);if(0===n)return!0;r=n<0?r.left:r.right}return!1},m.prototype.forEach=function(t,r){for(var e=this._root,n=[],i=!1;!i;)null!==e?(n.push(e),e=e.left):0!==n.length?(e=n.pop(),t.call(r,e),e=e.right):i=!0;return this},m.prototype.range=function(t,r,e,n){for(var i=[],o=this._comparator,a=this._root;0!==i.length||a;)if(a)i.push(a),a=a.left;else{if(0<o((a=i.pop()).key,r))break;if(0<=o(a.key,t)&&e.call(n,a))return this;a=a.right}return this},m.prototype.keys=function(){var e=[];return this.forEach(function(t){var r=t.key;return e.push(r)}),e},m.prototype.values=function(){var e=[];return this.forEach(function(t){var r=t.data;return e.push(r)}),e},m.prototype.min=function(){return this._root?this.minNode(this._root).key:null},m.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},m.prototype.minNode=function(t){if(void 0===t&&(t=this._root),t)for(;t.left;)t=t.left;return t},m.prototype.maxNode=function(t){if(void 0===t&&(t=this._root),t)for(;t.right;)t=t.right;return t},m.prototype.at=function(t){for(var r=this._root,e=!1,n=0,i=[];!e;)if(r)i.push(r),r=r.left;else if(0<i.length){if(r=i.pop(),n===t)return r;n++,r=r.right}else e=!0;return null},m.prototype.next=function(t){var r=this._root,e=null;if(t.right){for(e=t.right;e.left;)e=e.left;return e}for(var n=this._comparator;r;){var i=n(t.key,r.key);if(0===i)break;r=i<0?(e=r).left:r.right}return e},m.prototype.prev=function(t){var r=this._root,e=null;if(null!==t.left){for(e=t.left;e.right;)e=e.right;return e}for(var n=this._comparator;r;){var i=n(t.key,r.key);if(0===i)break;r=i<0?r.left:(e=r).right}return e},m.prototype.clear=function(){return this._root=null,this._size=0,this},m.prototype.toList=function(){return function(t){var r=t,e=[],n=!1,i={next:null},o=i;for(;!n;)r?(e.push(r),r=r.left):0<e.length?r=(r=o=o.next=e.pop()).right:n=!0;return o.next=null,i.next}(this._root)},m.prototype.load=function(t,r,e){void 0===t&&(t=[]),void 0===r&&(r=[]),void 0===e&&(e=!1);var n=t.length,i=this._comparator;if(e&&function t(r,e,n,i,o){if(i<=n)return;var a=r[n+i>>1];var s=n-1;var f=i+1;for(;;){for(;o(r[++s],a)<0;);for(;0<o(r[--f],a););if(f<=s)break;var h=r[s];r[s]=r[f],r[f]=h,h=e[s],e[s]=e[f],e[f]=h}t(r,e,n,f,o);t(r,e,f+1,i,o)}(t,r,0,n-1,i),null===this._root)this._root=function t(r,e,n,i,o){var a=o-i;if(0<a){var s=i+Math.floor(a/2),f=e[s],h=n[s],u={key:f,data:h,parent:r};return u.left=t(u,e,n,i,s),u.right=t(u,e,n,s+1,o),u}return null}(this._root,t,r,0,n),this._size=n;else{var o=function(t,r,e){void 0===e&&(e=function(t,r){return t-r});var n={},i=n,o=t,a=r;for(;null!==o&&null!==a;)e(o.key,a.key)<0?o=(i.next=o).next:a=(i.next=a).next,i=i.next;null!==o?i.next=o:null!==a&&(i.next=a);return n.next}(this.toList(),function(t,r){for(var e={next:null},n=e,i=0;i<t.length;i++)n=n.next={key:t[i],data:r[i]};return n.next=null,e.next}(t,r),i);n=this._size+n,this._root=function t(r,e,n){var i=n-e;if(0<i){var o=e+Math.floor(i/2),a=t(r,e,o),s=r.head;return s.left=a,r.head=r.head.next,s.right=t(r,o+1,n),s}return null}({head:o},0,n)}return this},m.prototype.isEmpty=function(){return null===this._root},n.size.get=function(){return this._size},m.prototype.toString=function(t){void 0===t&&(t=function(t){return t.key});var r=[];return function t(r,e,n,i,o){if(r){i(e+(n?"└── ":"├── ")+o(r)+"\n");var a=e+(n?"    ":"│   ");r.left&&t(r.left,a,!1,i,o),r.right&&t(r.right,a,!0,i,o)}}(this._root,"",!0,function(t){return r.push(t)},t),r.join("")},m.prototype.update=function(t,r,e){var n,i,o,a=this._comparator,s=y(t,this._root,a),f=s.left,h=s.right;this._size--,a(t,r)<0?h=l(r,e,h,a,this):f=l(r,e,f,a,this),this._root=(n=f,o=a,null===(i=h)?n:(null===n||((i=u(n.key,i,o)).left=n),i))},m.prototype.split=function(t){return y(t,this._root,this._comparator)},Object.defineProperties(m.prototype,n);var h=1e-9;function x(t,r,e){var n=t.from.y-e,i=e-t.to.y,o=t.to.y-t.from.y;if(Math.abs(n)<h)return Math.abs(o)<h?r<=t.from.x?t.from.x:r>t.to.x?t.to.x:r:t.from.x;var a,s=t.to.x-t.from.x;return i<=n?(a=n*(s/o),t.from.x-a):(a=i*(s/o),t.to.x+a)}function g(t,r){return Math.abs(t.x-r.x)<h&&Math.abs(t.y-r.y)<h}function a(y,f){var h,o,u,a,l=!1,p=new m(v),c={beforeLeft:null,left:null,right:null,afterRight:null},s={left:null,right:null};return{insertSegments:function(t,r,e){var n;h=e.y,u=e.x;for(var i=0;i<t.length;++i)n=t[i],p.add(n);for(i=0;i<r.length;++i)n=r[i],p.add(n)},deleteSegments:function(t,r,e){var n,i=p._size;for(a=u,o=h,h=e.y,u=e.x,l=!0,n=0;n<t.length;++n)_(t[n],e);for(n=0;n<r.length;++n)_(r[n],e);l=!1,p._size!==i-r.length-t.length&&y("Segments were not removed from a tree properly. Precision error?")},getLeftRightPoint:function(t){var r,e=p._root,n=Number.POSITIVE_INFINITY;for(;e;){var i=x(e.key,t.x,t.y),o=t.x-i;if(0<=o){if(!(o<n))break;n=o,e=(r=e).left}else{if(!(-o<n))break;n=-o,e=(r=e).right}}s.left=r&&r.key;var a=r&&p.next(r);return s.right=a&&a.key,s},getBoundarySegments:function(t,r){var e,n,i,o=t.length;e=n=0<o?t[0]:r[0];for(i=1;i<o;++i){var a=t[i],s=v(e,a);0<s&&(e=a),(s=v(n,a))<0&&(n=a)}for(i=0<o?0:1;i<r.length;++i)a=r[i],0<(s=v(e,a))&&(e=a),(s=v(n,a))<0&&(n=a);var f=p.find(e);f||y("Left is missing. Precision error?");var h=p.find(n);h||y("Right is missing. Precision error?");var u=f&&p.prev(f),l=h&&p.next(h);for(;l&&0===h.key.dy&&0===l.key.dy;)l=p.next(l);return c.beforeLeft=u&&u.key,c.left=f&&f.key,c.right=h&&h.key,c.afterRight=l&&l.key,c},findSegmentsWithPoint:function(t,r){var e=p._root;for(;e;){var n=x(e.key,t.x,t.y),i=t.x-n;if(Math.abs(i)<f){d(e,t,r);break}e=i<0?e.left:e.right}},status:p,checkDuplicate:function(){var e;p.forEach(function(t){var r=t.key;e&&g(e.from,r.from)&&g(e.to,r.to)&&y("Duplicate key in the status! This may be caused by Floating Point rounding error"),e=r})},printStatus:function(t){void 0===t&&(t="");console.log(t,"status line: ",u,h),p.forEach(function(t){var r=x(t.key,u,h);console.log(r+" "+t.key.name)})},getLastPoint:function(){return{x:u,y:h}}};function v(t,r){if(t===r)return 0;var e=x(t,u,h)-x(r,u,h);if(Math.abs(e)>=f)return e;var n=Math.abs(t.dy)<f,i=Math.abs(r.dy)<f;if(n&&i)return r.to.x-t.to.x;if(n)return l?-1:1;if(i)return l?r.from.x>=u?-1:1:-1;var o=t.angle,a=r.angle;if(Math.abs(o-a)>=f)return l?o-a:a-o;var s=t.from.y-r.from.y;return Math.abs(s)>=f?-s:(s=t.to.y-r.to.y,Math.abs(s)>=f?-s:0)}function d(t,r,e){e(t.key),function t(r,e,n){if(!r)return;var i=x(r.key,e.x,e.y);var o=e.x-i;Math.abs(o)<f?d(r,e,n):t(r.right,e,n)}(t.left,r,e),function t(r,e,n){if(!r)return;var i=x(r.key,e.x,e.y);var o=e.x-i;Math.abs(o)<f?d(r,e,n):t(r.left,e,n)}(t.right,r,e)}function _(t,r){p.find(t)?p.remove(t):(u=a,h=o,p.find(t)&&p.remove(t),h=r.y,u=r.x)}}var b=function(t,r){this.point=t,r&&(this.from=[r])},k=[];function w(t){Math.abs(t.x)<h&&(t.x=0),Math.abs(t.y)<h&&(t.y=0)}function A(t){throw new Error(t)}function E(t,r){return t?r?t.concat(r):t:r}function M(t,r){var e=r.y-t.y;return Math.abs(e)<h&&(e=t.x-r.x,Math.abs(e)<h&&(e=0)),e}function v(t,r){var e=t.from,n=r.from,i=e.x,o=e.y,a=n.x,s=n.y,f=t.from.x-t.to.x,h=t.from.y-t.to.y,u=r.from.x-r.to.x,l=r.from.y-r.to.y,y=f*l-u*h,p=(h*(i-a)-f*(o-s))/y;if(!(p<0||1<p)){var c=(u*(s-o)+l*(i-a))/y;return 0<=c&&c<=1?{x:i-c*f,y:o-c*h}:void 0}}var p=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],s=function(t,r,e,n){if(void 0===t)throw new Error("Missing required argument: numItems.");if(isNaN(t)||t<=0)throw new Error("Unpexpected numItems value: "+t+".");this.numItems=+t,this.nodeSize=Math.min(Math.max(+r||16,2),65535);var i=t,o=i;for(this._levelBounds=[4*i];o+=i=Math.ceil(i/this.nodeSize),this._levelBounds.push(4*o),1!==i;);this.ArrayType=e||Float64Array,this.IndexArrayType=o<16384?Uint16Array:Uint32Array;var a=p.indexOf(this.ArrayType),s=4*o*this.ArrayType.BYTES_PER_ELEMENT;if(a<0)throw new Error("Unexpected typed array class: "+e+".");n&&n instanceof ArrayBuffer?(this.data=n,this._boxes=new this.ArrayType(this.data,8,4*o),this._indices=new this.IndexArrayType(this.data,8+s,o),this._pos=4*o,this.minX=this._boxes[this._pos-4],this.minY=this._boxes[this._pos-3],this.maxX=this._boxes[this._pos-2],this.maxY=this._boxes[this._pos-1]):(this.data=new ArrayBuffer(8+s+o*this.IndexArrayType.BYTES_PER_ELEMENT),this._boxes=new this.ArrayType(this.data,8,4*o),this._indices=new this.IndexArrayType(this.data,8+s,o),this._pos=0,this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,new Uint8Array(this.data,0,2).set([251,48+a]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=t)};function I(t,r,e,n,i){var o=t[n];t[n]=t[i],t[i]=o;var a=4*n,s=4*i,f=r[a],h=r[a+1],u=r[a+2],l=r[a+3];r[a]=r[s],r[a+1]=r[s+1],r[a+2]=r[s+2],r[a+3]=r[s+3],r[s]=f,r[s+1]=h,r[s+2]=u,r[s+3]=l;var y=e[n];e[n]=e[i],e[i]=y}function S(t,r){var e=t^r,n=65535^e,i=65535^(t|r),o=t&(65535^r),a=e|n>>1,s=e>>1^e,f=i>>1^n&o>>1^i,h=e&i>>1^o>>1^o;s=(e=a)&(n=s)>>2^n&(e^n)>>2,f^=e&(i=f)>>2^n&(o=h)>>2,h^=n&i>>2^(e^n)&o>>2,s=(e=a=e&e>>2^n&n>>2)&(n=s)>>4^n&(e^n)>>4,f^=e&(i=f)>>4^n&(o=h)>>4,h^=n&i>>4^(e^n)&o>>4,f^=(e=a=e&e>>4^n&n>>4)&(i=f)>>8^(n=s)&(o=h)>>8;var u=t^r,l=(n=(h^=n&i>>8^(e^n)&o>>8)^h>>1)|65535^(u|(e=f^f>>1));return((l=1431655765&((l=858993459&((l=252645135&((l=16711935&(l|l<<8))|l<<4))|l<<2))|l<<1))<<1|(u=1431655765&((u=858993459&((u=252645135&((u=16711935&(u|u<<8))|u<<4))|u<<2))|u<<1)))>>>0}s.from=function(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");var r=new Uint8Array(t,0,2),e=r[0],n=r[1];if(251!==e)throw new Error("Data does not appear to be in a Flatbush format.");if(n>>4!=3)throw new Error("Got v"+(n>>4)+" data when expected v3.");var i=new Uint16Array(t,2,1)[0],o=new Uint32Array(t,4,1)[0];return new s(o,i,p[15&n],t)},s.prototype.add=function(t,r,e,n){var i=this._pos>>2;this._indices[i]=i,this._boxes[this._pos++]=t,this._boxes[this._pos++]=r,this._boxes[this._pos++]=e,this._boxes[this._pos++]=n,t<this.minX&&(this.minX=t),r<this.minY&&(this.minY=r),e>this.maxX&&(this.maxX=e),n>this.maxY&&(this.maxY=n)},s.prototype.finish=function(){var t=this;if(this._pos>>2!==this.numItems)throw new Error("Added "+(this._pos>>2)+" items when expected "+this.numItems+".");for(var r=this.maxX-this.minX,e=this.maxY-this.minY,n=new Uint32Array(this.numItems),i=0;i<this.numItems;i++){var o=4*i,a=t._boxes[o++],s=t._boxes[o++],f=t._boxes[o++],h=t._boxes[o++],u=Math.floor(65535*((a+f)/2-t.minX)/r),l=Math.floor(65535*((s+h)/2-t.minY)/e);n[i]=S(u,l)}!function t(r,e,n,i,o){if(o<=i)return;var a=r[i+o>>1];var s=i-1;var f=o+1;for(;;){for(;r[++s]<a;);for(;r[--f]>a;);if(f<=s)break;I(r,e,n,s,f)}t(r,e,n,i,f);t(r,e,n,f+1,o)}(n,this._boxes,this._indices,0,this.numItems-1);for(var y=0,p=0;y<this._levelBounds.length-1;y++)for(var c=t._levelBounds[y];p<c;){for(var v=1/0,d=1/0,_=-1/0,m=-1/0,x=p,g=0;g<this.nodeSize&&p<c;g++){var b=t._boxes[p++],k=t._boxes[p++],w=t._boxes[p++],A=t._boxes[p++];b<v&&(v=b),k<d&&(d=k),_<w&&(_=w),m<A&&(m=A)}t._indices[t._pos>>2]=x,t._boxes[t._pos++]=v,t._boxes[t._pos++]=d,t._boxes[t._pos++]=_,t._boxes[t._pos++]=m}},s.prototype.search=function(t,r,e,n,i){var o=this;if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");for(var a=this._boxes.length-4,s=this._levelBounds.length-1,f=[],h=[];void 0!==a;){for(var u=Math.min(a+4*o.nodeSize,o._levelBounds[s]),l=a;l<u;l+=4){var y=o._indices[l>>2];e<o._boxes[l]||(n<o._boxes[l+1]||t>o._boxes[l+2]||r>o._boxes[l+3]||(a<4*o.numItems?(void 0===i||i(y))&&h.push(y):(f.push(y),f.push(s-1))))}s=f.pop(),a=f.pop()}return h},t.sweep=function(t,r){var e,u,l,y,n=[],v=r&&r.onFound||function(t,r){n.push({point:t,segments:r})},s=r&&r.onError||A,d=(e=new m(M),{isEmpty:function(){return e.isEmpty()},size:function(){return e.size},pop:function(){var t=e.pop();return t&&t.data},find:function(t){return e.find(t)},insert:function(t){e.add(t.point,t)}}),p=a(s,h);return t.forEach(o),{run:function(){for(;!d.isEmpty();){var t=d.pop();if(i(t))return}return n},step:function(){return!d.isEmpty()&&(i(d.pop()),!0)},addSegment:o,eventQueue:d,sweepStatus:p,results:n};function i(t){y=t.point;var r=t.from||k;u=l=void 0,p.findSegmentsWithPoint(y,c),u||(u=k),l||(l=k);var e,n,i=r.length,o=l.length,a=u.length,s=1<i+o+a;if((s||!s&&0===i&&0===a&&0<o)&&(t.isReported=!0,v(y,E(l,E(u,r)))))return!0;if(p.deleteSegments(u,l,y),p.insertSegments(l,r,y),i+o===0){var f=p.getLeftRightPoint(y);if(!(e=f.left))return;if(!(n=f.right))return;_(e,n,t)}else{var h=p.getBoundarySegments(r,l);_(h.beforeLeft,h.left,t),_(h.right,h.afterRight,t)}return!1}function c(t){g(t.to,y)?u?u.push(t):u=[t]:g(t.from,y)||(l?l.push(t):l=[t])}function _(t,r,e){if(t&&r){var n=function(t,r){var e=t.from,n=r.from,i=e.x,o=e.y,a=n.x,s=n.y,f=t.dx,h=t.dy,u=r.dx,l=r.dy,y=f*l-u*h,p=(h*(i-a)-f*(o-s))/y;if(!(p<0||1<p)){var c=(u*(s-o)+l*(i-a))/y;return 0<=c&&c<=1?{x:i-c*f,y:o-c*h}:void 0}}(t,r);if(n){var i=e.point.y-n.y;if(!(i<-h||Math.abs(i)<h&&n.x<=e.point.x)){w(n);var o=d.find(n);if(o&&o.isReported)s("We already reported this event.");else if(!o){var a=new b(n);d.insert(a)}}}}}function o(t){var r=t.from,e=t.to;w(r),w(e);var n,i,o,a=r.y-e.y;if(Math.abs(a)<1e-5&&(r.y=e.y,t.dy=0),r.y<e.y||r.y===e.y&&r.x>e.x){var s=r;r=t.from=e,e=t.to=s}t.dy=r.y-e.y,t.dx=r.x-e.x,t.angle=(n=t.dy,i=t.dx,o=n/(Math.abs(n)+Math.abs(i)),i<0?o-1:1-o);var f=t.dy===t.dx&&0===t.dy,h=d.find(r);if(h&&!f){var u=h.data.from;if(u)for(var l=0;l<u.length;++l){var y=u[l];if(g(y.to,e))return v(y.from,[y.from,y.to]),void v(y.to,[y.from,y.to])}}if(f)c=new b(e),d.insert(c);else{if(h)h.data.from?h.data.from.push(t):h.data.from=[t];else{var p=new b(r,t);d.insert(p)}var c=new b(e);d.insert(c)}}},t.brute=function(o,t){var i,a=[],s=t&&t.onFound||function(t,r){a.push({point:t,segments:r})};return{run:function(){for(var t=0;t<o.length;++t)for(var r=o[t],e=t+1;e<o.length;++e){var n=o[e],i=v(r,n);if(i&&s(i,[r,n]))return}return a},results:a,step:function(){i||(i={i:0});for(var t=o[i.i],r=i.i+1;r<o.length;++r){var e=o[r],n=v(t,e);if(n&&s(n,[t,e]))return}return i.i+=1,i.i<o.length}}},t.bush=function(y,t){var r,e=[],p=t&&t.onFound||function(t,r){e.push({point:t,segments:r})},c=new s(y.length);return y.forEach(function(t){var r,e=t.from.x,n=t.to.x,i=t.from.y,o=t.to.y;n<e&&(r=e,e=n,n=r),o<i&&(r=i,i=o,o=r),c.add(e,i,n,o)}),c.finish(),{run:function(){for(var t=0;t<y.length;++t)if(n(y[t],t))return;return e},step:function(){return r||(r={i:0}),n(y[r.i],r.i),r.i+=1,r.i<y.length},results:e,checkIntersection:n};function n(t,r){var e,n=t.from.x,i=t.to.x,o=t.from.y,a=t.to.y;i<n&&(e=n,n=i,i=e),a<o&&(e=o,o=a,a=e);for(var s=c.search(n,o,i,a),f=0;f<s.length;++f){var h=s[f];if(!(h<=r)){var u=y[h],l=v(u,t);if(l&&p(l,[t,u]))return!0}}}},Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=isect.min.js.map
